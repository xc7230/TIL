# R

## 워드클라우드

워드 클라우드(word cloud) : 특정 주제와 관련된 키워드의 색상과 크기, 글자모음 형태를 활용해 주제를 쉽고 빠르게 인식할 수 있는 시각화 기법



### 애국가 형태소 분석 및  워드클라우드

```R
install.packages("KoNLP")
install.packages("wordcloud2")


# #워드 클라우드시작
require(KoNLP)
useNIADic()

word_data<-readLines("./data/애국가(가사).txt")
word_data

word_data2 <- sapply(word_data,extractNoun,USE.NAMES = F)
word_data2

undata <-unlist(word_data2)
undata

word_table <-table(undata)
word_table

undata2 <-Filter(function(x) {nchar(x)>=2},undata)

word_table2 <- table(undata2)
word_table2

sort(word_table2,decreasing = T)

require(wordcloud2)

wordcloud2(word_table2)
wordcloud2(word_table2,color = "random-light",backgroundColor = "black")
wordcloud2(word_table2,fontFamily ="맑은 고딕",size =1.2 , color="random-light",
           backgroundColor = "black",shape="star")

# 워드 클라우드 끝

#검색 API 사용 시작

# Client ID
# 3lKLkVlNmzu_kAdOc3WW
# 
# Client Secret
# 898stULjB6

urlStr <- "https://openapi.naver.com/v1/search/blog.xml?"
searchString <- "query=코타키나발루"
#UTF-8 인코딩
searchString <- iconv(searchString, to="UTF-8")
#URL 인코딩
searchString <- URLencode(searchString )
searchString

etcString <- "&display=100&start=1&sort=sim"

reqUrl <- paste(urlStr, searchString, etcString, sep="")
reqUrl

library(httr)
# clientID <- "3lKLkVlNmzu_kAdOc3WW"
# clientSecret <- "898stULjB6"

clientsID <- '3lKLkVlNmzu_kAdOc3WW'
clientSecret <- '898stULjB6'

apiResult <- GET(reqUrl, add_headers("X-Naver-Client-ID"=clientsID, "X-Naver-Client-Secret"=clientSecret))
apiResult

apiResult$content

result <- rawToChar(apiResult$content)
result

Encoding(result) <- "UTF-8"
result
###############################################
refinedStr <- result
refinedStr <- gsub("[<(/;&)>]"," ", refinedStr)
refinedStr
#단락을 표현하는 불필요한 문자를 공란으로 치환
refinedStr <- gsub("[[:punct:]]", " ", refinedStr)
refinedStr
#영어 소문자를 공란으로 치환
refinedStr <- gsub("[a-z]", " ", refinedStr)
refinedStr

#API 사용끝 

#검색결과 워드 클라우드 적용

word_data2 <- sapply(refinedStr,extractNoun,USE.NAMES = F)
word_data2

undata <-unlist(word_data2)
undata

word_table <-table(undata)
word_table

undata2 <-Filter(function(x) {nchar(x)>=2},undata)

word_table2 <- table(undata2)
word_table2

sort(word_table2,decreasing = T)

wordcloud2(word_table2)

wordcloud2(word_table2,fontFamily ="맑은 고딕",size =1.2 , color="random-light",
           backgroundColor = "black",shape="star")

wordcloud2(word_table2,figPath = "./data/peace.png")
```





### 영문서 형태소 분석 및  워드클라우드



```R
# Install
install.packages("tm")  # 텍스트 마이닝을 위한 패키지
install.packages("SnowballC") # 어간추출을 위한 패키지
#install.packages("wordcloud") # word-cloud generator 
install.packages("RColorBrewer") # color palettes
# Load
library("tm")
library("SnowballC")
#library("wordcloud")
library("RColorBrewer")

> filePath <- "http://www.sthda.com/sthda/RDoc/example-files/martin-luther-king-i-have-a-dream-speech.txt"
> text <- readLines(filePath)
> str(text)
 chr [1:46] "" ...

> docs <- Corpus(VectorSource(text))
> head(docs)
<<SimpleCorpus>>
Metadata:  corpus specific: 1, document level (indexed): 0
Content:  documents: 6

# 텍스트의 특수 문자 등을 대체하기 위해 tm_map () 함수를 사용하여 변환이 수행됩니다.
# “/”,“@”및“|”을 공백으로 바꿉니다.

> toSpace <- content_transformer(function (x , pattern ) gsub(pattern, " ", x))
> docs <- tm_map(docs, toSpace, "/")
Warning message:
In tm_map.SimpleCorpus(docs, toSpace, "/") : transformation drops documents
> docs <- tm_map(docs, toSpace, "@")
Warning message:
In tm_map.SimpleCorpus(docs, toSpace, "@") : transformation drops documents
> docs <- tm_map(docs, toSpace, "\\|")
Warning message:
In tm_map.SimpleCorpus(docs, toSpace, "\\|") :
  transformation drops documents
> head(docs)
<<SimpleCorpus>>
Metadata:  corpus specific: 1, document level (indexed): 0
Content:  documents: 6
docs <- Corpus(VectorSource(text))
# 텍스트의 특수 문자 등을 대체하기 위해 tm_map () 함수를 사용하여 변환이 수행됩니다.
# “/”,“@”및“|”을 공백으로 바꿉니다.
toSpace <- content_transformer(function (x , pattern ) gsub(pattern, " ", x))
docs <- tm_map(docs, toSpace, "/")
docs <- tm_map(docs, toSpace, "@")
docs <- tm_map(docs, toSpace, "\\|")
head(docs)

# 소문자로 변환
docs <- tm_map(docs, content_transformer(tolower))
# 수치 데이터 제거
docs <- tm_map(docs, removeNumbers)
# 영어 불용어 제거
docs <- tm_map(docs, removeWords, stopwords("english"))

# 벡터 구조로 사용자가 직접 불용어  설정 , 제거
docs <- tm_map(docs, removeWords, c("blabla1", "blabla2")) 

# 문장 부호 punctuations
docs <- tm_map(docs, removePunctuation)

# 공백 제거
docs <- tm_map(docs, stripWhitespace)

# 텍스트 형태소 분석
docs <- tm_map(docs, stemDocument)

> dtm <- TermDocumentMatrix(docs)
> m <- as.matrix(dtm)
> v <- sort(rowSums(m),decreasing=TRUE)
> d <- data.frame(word = names(v),freq=v)
> head(d, 10)
           word freq
will       will   17
freedom freedom   13
ring       ring   12
dream     dream   11
day         day   11
let         let   11
everi     everi    9
one         one    8
abl         abl    8
togeth   togeth    7
> 
> library(wordcloud)
> 
> set.seed(1234)
> wordcloud(words = d$word, freq = d$freq, min.freq = 1,
+           max.words=200, random.order=FALSE, rot.per=0.35, 
+           colors=brewer.pal(8, "Dark2"))

```



![1568177033636](assets/1568177033636.png)

## 오픈API이용하기



```R
#기본 URLrlStr <- "https://openapi.naver.com/v1/search/blog.xml?"
u
#검색어 설정 및 UTF-8 URL 인코딩
searchString <- "query=코타키나발루"
#UTF-8 인코딩
searchString <- iconv(searchString, to="UTF-8")
#URL 인코딩
searchString <- URLencode(searchString )
searchString

#나머지 요청 변수 : 조회 개수 100개, 시작페이지 1, 유사도순 정렬
etcString <- "&display=100&start=1&sort=sim"

#URL조합
reqUrl <- paste(urlStr, searchString, etcString, sep="")
reqUrl



library(httr)
clientsID <- '아이디'
clientSecret <- 'Secret'

apiResult <- GET(reqUrl, add_headers("X-Naver-Client-ID"=clientsID, "X-Naver-Client-Secret"=clientSecret))
apiResult

str(apiResult)

apiResult$content
str(apiResult$content)

result <- rawToChar(apiResult$content)
result

Encoding(result) <- "UTF-8"
result



refinedStr <- result
#XML 태그를 공란으로 치환
refinedStr <- gsub("<\\/?)(\\w+)*([^<>]*)>", " ", refinedStr)
refinedStr <- gsub("[<(/;&)>]"," ", refinedStr)
refinedStr
#단락을 표현하는 불필요한 문자를 공란으로 치환
refinedStr <- gsub("[[:punct:]]", " ", refinedStr)
refinedStr
#영어 소문자를 공란으로 치환
refinedStr <- gsub("[a-z]", " ", refinedStr)
refinedStr

#숫자를 공란으로 치환
refinedStr <- gsub("[0-9]", " ", refinedStr)
refinedStr

#여러 공란은 한 개의 공란으로 변경
refinedStr <- gsub(" +", " ", refinedStr)
refinedStr 

```





## ggplot2



### ggplot

```R
> library(ggplot2)

다음의 패키지를 부착합니다: ‘ggplot2’

The following object is masked _by_ ‘.GlobalEnv’:

    mpg

The following object is masked from ‘package:NLP’:

    annotate

> str(airquality)
'data.frame':	153 obs. of  6 variables:
 $ Ozone  : int  41 36 12 18 NA 28 23 19 8 NA ...
 $ Solar.R: int  190 118 149 313 NA NA 299 99 19 194 ...
 $ Wind   : num  7.4 8 12.6 11.5 14.3 14.9 8.6 13.8 20.1 8.6 ...
 $ Temp   : int  67 72 74 62 56 66 65 59 61 69 ...
 $ Month  : int  5 5 5 5 5 5 5 5 5 5 ...
 $ Day    : int  1 2 3 4 5 6 7 8 9 10 ...


> ggplot(airquality, aes(x = Day, y = Temp))
#x축은 Day열, y축은 Temp열로 맵핑
```

![1568177609967](assets/1568177609967.png)





### 산점도, geom_point

```R
#x축은 Day열, y축은 Temp열로 맵핑
ggplot(airquality, aes(x = Day, y = Temp)) + geom_point()
```

![1568178035329](assets/1568178035329.png)



```R
> ggplot(airquality, aes(x = Day, y = Temp)) + geom_point(size = 3, color = "red")
```

![1568178094196](assets/1568178094196.png)





### 꺾은선 그래프, geom_line()

```R
#x축은 Day열, y축은 Temp열로 맵핑 후 꺾은선 그래프 그리기
> ggplot(airquality, aes(x = Day, y = Temp)) + geom_line()
```

![1568178195594](assets/1568178195594.png)



### 그래프에 그래프 더하기

```R
#x축은 Day열, y축은 Temp열로 맵핑 후 꺾은선 그래프와 산점도 그리기
> ggplot(airquality, aes(x = Day, y = Temp))+ geom_point() + geom_line()
```

![1568178579156](assets/1568178579156.png)





### 막대그래프

```R
#mtcars에서 cyl 종류별 빈도수 확인
ggplot(mtcars, aes(x=cyl)) + geom_bar(width = 0.5)
```

![1568178702413](assets/1568178702413.png)



```R
# 빈 범주를 제외하고 cyl 종류별 빈도수 확인
ggplot(mtcars, aes(x=factor(cyl)) + geom_bar(width = 0.5)
```

![1568178881019](assets/1568178881019.png)



### 누적막대그래프

```R
#cyl 종류별 gear 빈도 누적 막대그래프
> ggplot(mtcars, aes(x=factor(cyl))) + geom_bar(aes(fill = factor(gear)))
```

![1568179018570](assets/1568179018570.png)



#### 누적막대그래프로 선버스트 차트그리기



```R
> ggplot(mtcars, aes(x=factor(cyl))) + geom_bar(aes(fill = factor(gear))) + coord_polar()
```

![1568179107050](assets/1568179107050.png)



### 상자그림 & 히스토그램

```R
#airquality에서 Day 열을 그륩 지어, 날짜별 온도 상자 그림을 그림
> ggplot(airquality, aes(x = Day, y = Temp, group = Day)) + geom_boxplot()
```

![1568179293963](assets/1568179293963.png)



### 히스토그램

```R
#airquality에서 Temp의 히스토그램
> ggplot(airquality, aes(Temp)) + geom_histogram()
`stat_bin()` using `bins = 30`. Pick better value
with `binwidth`.

#폭이 넓어 자동 조정을 한다.
#폭을 지정하려면 geom_histogram(binwidth = 1)
```

![1568179456231](assets/1568179456231.png)







