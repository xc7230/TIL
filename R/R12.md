# R



## 연관분석 비지도학습

### 연관 분석(Association Analysis) 

- 하나의 거래나 사건에 포함된 항목 간의 관련성을 파악하여 둘 이상의 항목들로 구성된 연관성 규칙을 도출하는 탐색적인 분석방법

- 군집분석에 의해서 생성된 군집(cluster)의 특성을 분석하는 장바구니 분석

- 예) 트랜잭션(상품 거래 정보)을 대상으로 트랜잭션 내의 연관성을 분석하여 상품 거래의 규칙이나 패턴을 통해서 상품 간의 연관성을 도출해내는 분석 방법

- 거래나 사건으로부터 연관성을 찾아내기 위해서는 각각 연관성을 비교할 수 있는 규칙(지지도support, 신뢰도confidence, 향상도lift)을 평가 척도로 사용한다.



#### 연관 분석(Association Analysis) 활용 분야

- 마케팅에 활용
- 예1) 고객 대상 상품추천 및 상품정보 발송 : A 고객에 대한 B 상품 쿠폰 발송
- 예2) 텔레마케팅을 통해서 패키지 상품 판매 기획 및 홍보
- 예3) 상점대 상품 진열 및 쇼윈도(show window) 상품 디스플레이



#### 연관 분석(Association Analysis) 특징

- 데이터베이스에서 사건의 연관규칙을 찾아는 데이터마이닝 기법이다.

- Y 변수가 없으면, 비지도 학습에 의한 패턴 분석 방법이다.

- 거래 사실이 기록된 트랜잭션(Transaction) 형식의 데이터 셋을 이용한다.

- 사건과 사건 간의 연관성을 찾는 방법(예: 기저귀와 맥주)이다

- 지지도(제품 동시 구매패턴), 신뢰도(A제품 구매시 B제품 구매패턴), 향상도(A 제품과 B 제품간의 상관성)를 연관규칙의 평가 도구로 사용한다.

- 활용분야 : 상품구매 규칙을 통한 구매패턴 예측(상품 연관성)



#### 연관 분석(Association Analysis) 절차

- 단계 1] 거래 내역 데이터를 대상으로 트랜잭션 객체 생성
- 단계 2] 품목(item)과 트랜잭션 ID 관찰
- 단계 3] 평가 척도(지지도, 신뢰도, 향상도)를 이용한 연관 규칙(rule) 발견
- 단계 4] 연관분석결과에 대한 시각화
- 단계 5] 연관분석결과 해설 및 업무 적용



#### 연관 분석(Association Analysis) 평가 척도  

- 연관규칙(Association Rule)  :  어떤 사건이 얼마나 자주 동시에 발생하는가를 표현하는 규칙(조건)으로 데이터 내에 포함된 특정 항목들의 연관성을 수치화시켜 나타내는 방법
- 지지도(Support) - 전체에 대한 품목 A와 품목 B가 동시에 일어나는 확률 
  전체 품목에서 관련 품목의 거래 확률을 나타낸다.

![1569288760308](assets/1569288760308.png)



- A를 구매한 후 B를 구매하는 거래 비율을 제공한다.
- 지지도가 낮다는 의미는 해당 규칙(A를 구매한 후 B를 구매하는 거래)이 자주 발생하지 않는 규칙을 의미
- 지지도가 낮은 규칙을 제거하는데 이용
- 지지도는 Support(A->B)와 Support(B->A)가 상호 대칭적으로 서로 같은 값을 가진다.

 



#### 연관 분석(Association Analysis) 평가 척도

- 신뢰도(confidence) - 품목 A가 구매될 때 품목 B가 구매되는 경우의 조건부확률  

![1569288860881](assets/1569288860881.png)



지지도가 상호 대칭적으로 Support(A->B)와 Support(B->A)가 서로 같은 값을 가지기 때문에 포함비중이 낮은 경우에는 연관성을 판단하는데 어려움이 있다.
 지지도의 단점을 보완하는 것이 신뢰도이며 품목 A가 포함된 거래 중에서 품목 B를 포함한 거래의 비율을 제공한다.

- 향상도(Lift) - 하위 항목들이 독립에서 얼마나 벗어나는지의 정도를 측정한 값

![1569288926008](assets/1569288926008.png)



지지도 또는 신뢰도가 높은 연관성 규칙 중에서는 우연히 연관성이 높게 보이는 것들이 나타날 수도 있는데, 이부분을 보완하기 위해 향상도가 사용된다.
 두 상품의 독립성 여부를 수치로 제공- 독립성 여부에 따라서 상품 간의 상관관계를 예측할 수 있다.

![1569288944349](assets/1569288944349.png)



- 향상도 (Lift)가 1에 가까우면 두 상품은 서로 독립적이고, 1보다 작으면 두 상품은 음의 상관성을 1보다 크면 두 상품은 양의 상관성을 나타낸다.

- 연관규칙에 의미가 있으려면 향상도가 1보다 큰 값이어야 한다. (향상도의 값이 클수록 상품 간의 연관성이 높다고 볼 수 있다) 



#### 트랜잭션 객체를 대상으로 연관 규칙 생성  



- arules 패키지는 read.transactions(), apriori() 와 Adult와 AdultUCK 데이터 셋을 제공한다.

- arules 패키지에서 제공하는 inspect() 함수를 이용하여 트랜잭션 객체를 확인할 수 있다.

- arules 패키지에서 제공하는 apriori()를 이용하여 트랜잭션 객체를 대상으로 규칙을 발견할 수 있다.



![1569289377132](assets/1569289377132.png)



```R
> library(arules)
> tran <- read.transactions("./data5/tran.txt", format="basket",sep=",")
> #거래 data는 6개
> inspect(tran)
    items           
[1] {라면,맥주,우유}
[2] {고기,라면,우유}
[3] {고기,과일,라면}
[4] {고기,맥주,우유}
[5] {고기,라면,우유}
[6] {과일,우유}     


> #거래 data는 6개
> inspect(tran)   #항목(품목) 확인
    items           
[1] {라면,맥주,우유}
[2] {고기,라면,우유}
[3] {고기,과일,라면}
[4] {고기,맥주,우유}
[5] {고기,라면,우유}
[6] {과일,우유}     
> 
> rule <- apriori(tran, parameter=list(supp=0.3, conf=0.1))
Apriori

Parameter specification:
 confidence minval smax arem  aval originalSupport
        0.1    0.1    1 none FALSE            TRUE
 maxtime support minlen maxlen target   ext
       5     0.3      1     10  rules FALSE

Algorithmic control:
 filter tree heap memopt load sort verbose
    0.1 TRUE TRUE  FALSE TRUE    2    TRUE

Absolute minimum support count: 1 

set item appearances ...[0 item(s)] done [0.00s].
set transactions ...[5 item(s), 6 transaction(s)] done [0.00s].
sorting and recoding items ... [5 item(s)] done [0.00s].
creating transaction tree ... done [0.00s].
checking subsets of size 1 2 3 done [0.00s].
writing ... [16 rule(s)] done [0.00s].
creating S4 object  ... done [0.00s].
> #맥주를 구매한 사람은 대체로 고기를 사지 않는다
> #{라면, 맥주} => {우유}는 향상도가 1.2이므로 두 상품간의 상관성이 높습니다.
> 
> rule2 <- apriori(tran, parameter=list(supp=0.1, conf=0.1))
Apriori

Parameter specification:
 confidence minval smax arem  aval originalSupport
        0.1    0.1    1 none FALSE            TRUE
 maxtime support minlen maxlen target   ext
       5     0.1      1     10  rules FALSE

Algorithmic control:
 filter tree heap memopt load sort verbose
    0.1 TRUE TRUE  FALSE TRUE    2    TRUE

Absolute minimum support count: 0 

set item appearances ...[0 item(s)] done [0.00s].
set transactions ...[5 item(s), 6 transaction(s)] done [0.00s].
sorting and recoding items ... [5 item(s)] done [0.00s].
creating transaction tree ... done [0.00s].
checking subsets of size 1 2 3 done [0.00s].
writing ... [35 rule(s)] done [0.00s].
creating S4 object  ... done [0.00s].


> stran <- read.transactions("./data5/demo_single", format="single", cols=c(1,2))
> inspect(stran)
    items         transactionID
[1] {item1}       trans1       
[2] {item1,item2} trans2       


> stran2 <- read.transactions("./data5/single_format.csv", format="single", cols=c(1,2))
> stran2  #트랜잭션 248, 항목은 68
transactions in sparse format with
 616 transactions (rows) and
 600 items (columns)

> summary(stran2)
transactions as itemMatrix in sparse format with
 616 rows (elements/itemsets/transactions) and
 600 columns (items) and a density of 0.001739719 

most frequent items:
2010-04-01-0827,10001519 2010-04-03-0828,10001519 
                       3                        3 
2010-07-17-0823,10001519 2010-07-18-0825,10001519 
                       3                        3 
2010-01-09-0818,10186585                  (Other) 
                       2                      629 

element (itemset/transaction) length distribution:
sizes
  1   2   3 
592  21   3 

   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  1.000   1.000   1.000   1.044   1.000   3.000 

includes extended item information - examples:
                    labels
1 2010-01-01-0823,10000005
2 2010-01-01-0823,10001519
3 2010-01-01-0823,10003333

includes extended transaction information - examples:
             transactionID
1 2010-01-01-0823,10003364
2 2010-01-01-0823,10003374
3 2010-01-01-0823,10007892


> #규칙 생성 (연관규칙 생성을 위한 평가척도 기본값 supp=0.1, conf=0.8)
> astran2 <- apriori(stran2) # 102 rules

Apriori

Parameter specification:
 confidence minval smax arem  aval originalSupport
        0.8    0.1    1 none FALSE            TRUE
 maxtime support minlen maxlen target   ext
       5     0.1      1     10  rules FALSE

Algorithmic control:
 filter tree heap memopt load sort verbose
    0.1 TRUE TRUE  FALSE TRUE    2    TRUE

Absolute minimum support count: 61 

set item appearances ...[0 item(s)] done [0.00s].
set transactions ...[600 item(s), 616 transaction(s)] done [0.00s].
sorting and recoding items ... [0 item(s)] done [0.00s].
creating transaction tree ... done [0.00s].
checking subsets of size 1 done [0.00s].
writing ... [0 rule(s)] done [0.00s].
creating S4 object  ... done [0.00s].




```



####  연관규칙 생성, 네트워크 형태로 시각화

```R
##### 연관규칙 생성, 네트워크 형태로 시각화######
data(Adult) 
str(Adult) 

> data(Adult) 
> str(Adult) 
Formal class 'transactions' [package "arules"] with 3 slots
  ..@ data       :Formal class 'ngCMatrix' [package "Matrix"] with 5 slots
  .. .. ..@ i       : int [1:612200] 1 10 25 32 35 50 59 61 63 65 ...
  .. .. ..@ p       : int [1:48843] 0 13 26 39 52 65 78 91 104 117 ...
  .. .. ..@ Dim     : int [1:2] 115 48842
  .. .. ..@ Dimnames:List of 2
  .. .. .. ..$ : NULL
  .. .. .. ..$ : NULL
  .. .. ..@ factors : list()
  ..@ itemInfo   :'data.frame':	115 obs. of  3 variables:
  .. ..$ labels   : chr [1:115] "age=Young" "age=Middle-aged" "age=Senior" "age=Old" ...
  .. ..$ variables: Factor w/ 13 levels "age","capital-gain",..: 1 1 1 1 13 13 13 13 13 13 ...
  .. ..$ levels   : Factor w/ 112 levels "10th","11th",..: 111 63 92 69 30 54 65 82 90 91 ...
  ..@ itemsetInfo:'data.frame':	48842 obs. of  1 variable:
  .. ..$ transactionID: chr [1:48842] "1" "2" "3" "4" ...


# AdultUCI 데이터셋을 트랜잭션 객체로 변환한 데이터셋
# 관측치 48,842 , 변수 15개 
# 종속변수(Class)에 의해서 연간 개입 수입이 $5만 이상인지를 예측하는 데이터 셋

> attributes(Adult) #transaction의 변주와 범주

> adult <- as(Adult, "data.frame") 
> head(adult)
                                                                                                                                                                                                                                                                     items
1      {age=Middle-aged,workclass=State-gov,education=Bachelors,marital-status=Never-married,occupation=Adm-clerical,relationship=Not-in-family,race=White,sex=Male,capital-gain=Low,capital-loss=None,hours-per-week=Full-time,native-country=United-States,income=small}
2 {age=Senior,workclass=Self-emp-not-inc,education=Bachelors,marital-status=Married-civ-spouse,occupation=Exec-managerial,relationship=Husband,race=White,sex=Male,capital-gain=None,capital-loss=None,hours-per-week=Part-time,native-country=United-States,income=small}
3         {age=Middle-aged,workclass=Private,education=HS-grad,marital-status=Divorced,occupation=Handlers-cleaners,relationship=Not-in-family,race=White,sex=Male,capital-gain=None,capital-loss=None,hours-per-week=Full-time,native-country=United-States,income=small}
4             {age=Senior,workclass=Private,education=11th,marital-status=Married-civ-spouse,occupation=Handlers-cleaners,relationship=Husband,race=Black,sex=Male,capital-gain=None,capital-loss=None,hours-per-week=Full-time,native-country=United-States,income=small}
5                {age=Middle-aged,workclass=Private,education=Bachelors,marital-status=Married-civ-spouse,occupation=Prof-specialty,relationship=Wife,race=Black,sex=Female,capital-gain=None,capital-loss=None,hours-per-week=Full-time,native-country=Cuba,income=small}
6        {age=Middle-aged,workclass=Private,education=Masters,marital-status=Married-civ-spouse,occupation=Exec-managerial,relationship=Wife,race=White,sex=Female,capital-gain=None,capital-loss=None,hours-per-week=Full-time,native-country=United-States,income=small}
  transactionID
1             1
2             2
3             3
4             4
5             5
6             6
> str(adult)
'data.frame':	48842 obs. of  2 variables:
 $ items        : Factor w/ 26771 levels "{age=Middle-aged,education=10th,marital-status=Divorced,relationship=Not-in-family,race=White,sex=Female,capita"| __truncated__,..: 12330 20981 6200 16289 5154 8308 16981 21198 8525 4929 ...
 $ transactionID: chr  "1" "2" "3" "4" ...


> summary(adult)
                                                                                                                                                                                                                                                                  items      
 {age=Middle-aged,workclass=Private,education=HS-grad,marital-status=Married-civ-spouse,occupation=Craft-repair,relationship=Husband,race=White,sex=Male,capital-gain=None,capital-loss=None,hours-per-week=Full-time,native-country=United-States,income=small}     :  207  
 {age=Middle-aged,workclass=Private,education=HS-grad,marital-status=Married-civ-spouse,occupation=Craft-repair,relationship=Husband,race=White,sex=Male,capital-gain=None,capital-loss=None,hours-per-week=Full-time,native-country=United-States}                  :  137  
 {age=Middle-aged,workclass=Private,education=HS-grad,marital-status=Married-civ-spouse,occupation=Machine-op-inspct,relationship=Husband,race=White,sex=Male,capital-gain=None,capital-loss=None,hours-per-week=Full-time,native-country=United-States,income=small}:  110  
 {age=Senior,workclass=Private,education=HS-grad,marital-status=Married-civ-spouse,occupation=Craft-repair,relationship=Husband,race=White,sex=Male,capital-gain=None,capital-loss=None,hours-per-week=Full-time,native-country=United-States,income=small}          :  107  
 {age=Middle-aged,workclass=Private,education=HS-grad,marital-status=Married-civ-spouse,occupation=Craft-repair,relationship=Husband,race=White,sex=Male,capital-gain=None,capital-loss=None,hours-per-week=Over-time,native-country=United-States,income=small}     :  102  
 {age=Middle-aged,workclass=Private,education=Bachelors,marital-status=Married-civ-spouse,occupation=Exec-managerial,relationship=Husband,race=White,sex=Male,capital-gain=None,capital-loss=None,hours-per-week=Over-time,native-country=United-States,income=large}:   86  
 (Other)                                                                                                                                                                                                                                                             :48093  
 transactionID     
 Length:48842      
 Class :character  
 Mode  :character  


> ar <- apriori(Adult, parameter=list(supp=0.1, conf=0.8))  #rules는 6,137개
Apriori

Parameter specification:
 confidence minval smax arem  aval originalSupport
        0.8    0.1    1 none FALSE            TRUE
 maxtime support minlen maxlen target   ext
       5     0.1      1     10  rules FALSE

Algorithmic control:
 filter tree heap memopt load sort verbose
    0.1 TRUE TRUE  FALSE TRUE    2    TRUE

Absolute minimum support count: 4884 

set item appearances ...[0 item(s)] done [0.00s].
set transactions ...[115 item(s), 48842 transaction(s)] done [0.04s].
sorting and recoding items ... [31 item(s)] done [0.01s].
creating transaction tree ... done [0.02s].
checking subsets of size 1 2 3 4 5 6 7 8 9 done [0.10s].
writing ... [6137 rule(s)] done [0.00s].
creating S4 object  ... done [0.01s].
> 
> ar2 <- apriori(Adult, parameter=list(supp=0.3, conf=0.95))  #rules는 124개
Apriori

Parameter specification:
 confidence minval smax arem  aval originalSupport
       0.95    0.1    1 none FALSE            TRUE
 maxtime support minlen maxlen target   ext
       5     0.3      1     10  rules FALSE

Algorithmic control:
 filter tree heap memopt load sort verbose
    0.1 TRUE TRUE  FALSE TRUE    2    TRUE

Absolute minimum support count: 14652 

set item appearances ...[0 item(s)] done [0.00s].
set transactions ...[115 item(s), 48842 transaction(s)] done [0.04s].
sorting and recoding items ... [14 item(s)] done [0.00s].
creating transaction tree ... done [0.02s].
checking subsets of size 1 2 3 4 5 6 done [0.00s].
writing ... [124 rule(s)] done [0.00s].
creating S4 object  ... done [0.00s].
> 
> 
> ar3 <- apriori(Adult, parameter=list(supp=0.35, conf=0.95))  #rules는  67
Apriori

Parameter specification:
 confidence minval smax arem  aval originalSupport
       0.95    0.1    1 none FALSE            TRUE
 maxtime support minlen maxlen target   ext
       5    0.35      1     10  rules FALSE

Algorithmic control:
 filter tree heap memopt load sort verbose
    0.1 TRUE TRUE  FALSE TRUE    2    TRUE

Absolute minimum support count: 17094 

set item appearances ...[0 item(s)] done [0.00s].
set transactions ...[115 item(s), 48842 transaction(s)] done [0.04s].
sorting and recoding items ... [11 item(s)] done [0.00s].
creating transaction tree ... done [0.02s].
checking subsets of size 1 2 3 4 5 done [0.00s].
writing ... [67 rule(s)] done [0.00s].
creating S4 object  ... done [0.00s].
> 
> ar4 <- apriori(Adult, parameter=list(supp=0.4, conf=0.95))  #rules는  36
Apriori

Parameter specification:
 confidence minval smax arem  aval originalSupport
       0.95    0.1    1 none FALSE            TRUE
 maxtime support minlen maxlen target   ext
       5     0.4      1     10  rules FALSE

Algorithmic control:
 filter tree heap memopt load sort verbose
    0.1 TRUE TRUE  FALSE TRUE    2    TRUE

Absolute minimum support count: 19536 

set item appearances ...[0 item(s)] done [0.00s].
set transactions ...[115 item(s), 48842 transaction(s)] done [0.04s].
sorting and recoding items ... [11 item(s)] done [0.00s].
creating transaction tree ... done [0.02s].
checking subsets of size 1 2 3 4 5 done [0.00s].
writing ... [36 rule(s)] done [0.00s].
creating S4 object  ... done [0.00s].
> 
> #상위 6개 규칙
> inspect(head(ar4))
    lhs                       rhs                                   support confidence     lift count
[1] {}                     => {capital-loss=None}                 0.9532779  0.9532779 1.000000 46560
[2] {relationship=Husband} => {marital-status=Married-civ-spouse} 0.4034233  0.9993914 2.181164 19704
[3] {relationship=Husband} => {sex=Male}                          0.4036485  0.9999493 1.495851 19715
[4] {age=Middle-aged}      => {capital-loss=None}                 0.4800786  0.9504276 0.997010 23448
[5] {income=small}         => {capital-gain=None}                 0.4849310  0.9581311 1.044414 23685
[6] {income=small}         => {capital-loss=None}                 0.4908480  0.9698220 1.017355 23974
> 
> #신뢰도 기준 내림차순 정렬 상위 6개
> inspect(head(sort(ar4, descreasing=T, by="confidence")))
    lhs                                    rhs                                   support confidence     lift count
[1] {relationship=Husband}              => {sex=Male}                          0.4036485  0.9999493 1.495851 19715
[2] {marital-status=Married-civ-spouse,                                                                           
     relationship=Husband}              => {sex=Male}                          0.4034028  0.9999492 1.495851 19703
[3] {relationship=Husband}              => {marital-status=Married-civ-spouse} 0.4034233  0.9993914 2.181164 19704
[4] {relationship=Husband,                                                                                        
     sex=Male}                          => {marital-status=Married-civ-spouse} 0.4034028  0.9993913 2.181164 19703
[5] {marital-status=Married-civ-spouse,                                                                           
     sex=Male}                          => {relationship=Husband}              0.4034028  0.9901503 2.452877 19703
[6] {income=small}                      => {capital-loss=None}                 0.4908480  0.9698220 1.017355 23974
> 
> 
> #향상도 기준 내림차순 정렬 상위 6개
> inspect(head(sort(ar4, descreasing=T, by="lift")))
    lhs                                    rhs                                   support confidence     lift count
[1] {marital-status=Married-civ-spouse,                                                                           
     sex=Male}                          => {relationship=Husband}              0.4034028  0.9901503 2.452877 19703
[2] {relationship=Husband}              => {marital-status=Married-civ-spouse} 0.4034233  0.9993914 2.181164 19704
[3] {relationship=Husband,                                                                                        
     sex=Male}                          => {marital-status=Married-civ-spouse} 0.4034028  0.9993913 2.181164 19703
[4] {relationship=Husband}              => {sex=Male}                          0.4036485  0.9999493 1.495851 19715
[5] {marital-status=Married-civ-spouse,                                                                           
     relationship=Husband}              => {sex=Male}                          0.4034028  0.9999492 1.495851 19703
[6] {income=small}                      => {capital-gain=None}                 0.4849310  0.9581311 1.044414 23685


> plot(ar3, method="graph", control=list(type="items"))
Warning: Unknown control parameters: type
Available control parameters (with default values):
main	 =  Graph for 67 rules
nodeColors	 =  c("#66CC6680", "#9999CC80")
nodeCol	 =  c("#EE0000FF", "#EE0303FF", "#EE0606FF", "#EE0909FF", "#EE0C0CFF", "#EE0F0FFF", "#EE1212FF", "#EE1515FF", "#EE1818FF", "#EE1B1BFF", "#EE1E1EFF", "#EE2222FF", "#EE2525FF", "#EE2828FF", "#EE2B2BFF", "#EE2E2EFF", "#EE3131FF", "#EE3434FF", "#EE3737FF", "#EE3A3AFF", "#EE3D3DFF", "#EE4040FF", "#EE4444FF", "#EE4747FF", "#EE4A4AFF", "#EE4D4DFF", "#EE5050FF", "#EE5353FF", "#EE5656FF", "#EE5959FF", "#EE5C5CFF", "#EE5F5FFF", "#EE6262FF", "#EE6666FF", "#EE6969FF", "#EE6C6CFF", "#EE6F6FFF", "#EE7272FF", "#EE7575FF",  "#EE7878FF", "#EE7B7BFF", "#EE7E7EFF", "#EE8181FF", "#EE8484FF", "#EE8888FF", "#EE8B8BFF", "#EE8E8EFF", "#EE9191FF", "#EE9494FF", "#EE9797FF", "#EE9999FF", "#EE9B9BFF", "#EE9D9DFF", "#EE9F9FFF", "#EEA0A0FF", "#EEA2A2FF", "#EEA4A4FF", "#EEA5A5FF", "#EEA7A7FF", "#EEA9A9FF", "#EEABABFF", "#EEACACFF", "#EEAEAEFF", "#EEB0B0FF", "#EEB1B1FF", "#EEB3B3FF", "#EEB5B5FF", "#EEB7B7FF", "#EEB8B8FF", "#EEBABAFF", "#EEBCBCFF", "#EEBDBDFF", "#EEBFBFFF", "#EEC1C1FF", "#EEC3C3FF", "#EEC4C4FF", "#EEC6C6FF", "#EEC8C8FF",  "#EEC9C9FF", "#EECBCBFF", "#EECDCDFF", "#EECFCFFF", "#EED0D0FF", "#EED2D2FF", "#EED4D4FF", "#EED5D5FF", "#EED7D7FF", "#EED9D9FF", "#EEDBDBFF", "#EEDCDCFF", "#EEDEDEFF", "#EEE0E0FF", "#EEE1E1FF", "#EEE3E3FF", "#EEE5E5FF", "#EEE7E7FF", "#EEE8E8FF", "#EEEAEAFF", "#EEECECFF", "#EEEEEEFF")
edgeCol	 =  c("#474747FF", "#494949FF", "#4B4B4BFF", "#4D4D4DFF", "#4F4F4FFF", "#515151FF", "#535353FF", "#555555FF", "#575757FF", "#595959FF", "#5B5B5BFF", "#5E5E5EFF", "#606060FF", "#626262FF", "#646464FF", "#666666FF", "#686868FF", "#6A6A6AFF", "#6C6C6CFF", "#6E6E6EFF", "#707070FF", "#727272FF", "#747474FF", "#767676FF", "#787878FF", "#7A7A7AFF", "#7C7C7CFF", "#7E7E7EFF", "#808080FF", "#828282FF", "#848484FF", "#868686FF", "#888888FF", "#8A8A8AFF", "#8C8C8CFF", "#8D8D8DFF", "#8F8F8FFF", "#919191FF", "#939393FF",  "#959595FF", "#979797FF", "#999999FF", "#9A9A9AFF", "#9C9C9CFF", "#9E9E9EFF", "#A0A0A0FF", "#A2A2A2FF", "#A3A3A3FF", "#A5A5A5FF", "#A7A7A7FF", "#A9A9A9FF", "#AAAAAAFF", "#ACACACFF", "#AEAEAEFF", "#AFAFAFFF", "#B1B1B1FF", "#B3B3B3FF", "#B4B4B4FF", "#B6B6B6FF", "#B7B7B7FF", "#B9B9B9FF", "#BBBBBBFF", "#BCBCBCFF", "#BEBEBEFF", "#BFBFBFFF", "#C1C1C1FF", "#C2C2C2FF", "#C3C3C4FF", "#C5C5C5FF", "#C6C6C6FF", "#C8C8C8FF", "#C9C9C9FF", "#CACACAFF", "#CCCCCCFF", "#CDCDCDFF", "#CECECEFF", "#CFCFCFFF", "#D1D1D1FF",  "#D2D2D2FF", "#D3D3D3FF", "#D4D4D4FF", "#D5D5D5FF", "#D6D6D6FF", "#D7D7D7FF", "#D8D8D8FF", "#D9D9D9FF", "#DADADAFF", "#DBDBDBFF", "#DCDCDCFF", "#DDDDDDFF", "#DEDEDEFF", "#DEDEDEFF", "#DFDFDFFF", "#E0E0E0FF", "#E0E0E0FF", "#E1E1E1FF", "#E1E1E1FF", "#E2E2E2FF", "#E2E2E2FF", "#E2E2E2FF")
alpha	 =  0.5
cex	 =  1
itemLabels	 =  TRUE
labelCol	 =  #000000B3
measureLabels	 =  FALSE
precision	 =  3
layout	 =  NULL
layoutParams	 =  list()
arrowSize	 =  0.5
engine	 =  igraph
plot	 =  TRUE
plot_options	 =  list()
max	 =  100
verbose	 =  FALSE

```

![1569292012855](assets/1569292012855.png)



```R
> plot(ar4, method="graph", control=list(type="items"))
Warning: Unknown control parameters: type
Available control parameters (with default values):
main	 =  Graph for 36 rules
nodeColors	 =  c("#66CC6680", "#9999CC80")
nodeCol	 =  c("#EE0000FF", "#EE0303FF", "#EE0606FF", "#EE0909FF", "#EE0C0CFF", "#EE0F0FFF", "#EE1212FF", "#EE1515FF", "#EE1818FF", "#EE1B1BFF", "#EE1E1EFF", "#EE2222FF", "#EE2525FF", "#EE2828FF", "#EE2B2BFF", "#EE2E2EFF", "#EE3131FF", "#EE3434FF", "#EE3737FF", "#EE3A3AFF", "#EE3D3DFF", "#EE4040FF", "#EE4444FF", "#EE4747FF", "#EE4A4AFF", "#EE4D4DFF", "#EE5050FF", "#EE5353FF", "#EE5656FF", "#EE5959FF", "#EE5C5CFF", "#EE5F5FFF", "#EE6262FF", "#EE6666FF", "#EE6969FF", "#EE6C6CFF", "#EE6F6FFF", "#EE7272FF", "#EE7575FF",  "#EE7878FF", "#EE7B7BFF", "#EE7E7EFF", "#EE8181FF", "#EE8484FF", "#EE8888FF", "#EE8B8BFF", "#EE8E8EFF", "#EE9191FF", "#EE9494FF", "#EE9797FF", "#EE9999FF", "#EE9B9BFF", "#EE9D9DFF", "#EE9F9FFF", "#EEA0A0FF", "#EEA2A2FF", "#EEA4A4FF", "#EEA5A5FF", "#EEA7A7FF", "#EEA9A9FF", "#EEABABFF", "#EEACACFF", "#EEAEAEFF", "#EEB0B0FF", "#EEB1B1FF", "#EEB3B3FF", "#EEB5B5FF", "#EEB7B7FF", "#EEB8B8FF", "#EEBABAFF", "#EEBCBCFF", "#EEBDBDFF", "#EEBFBFFF", "#EEC1C1FF", "#EEC3C3FF", "#EEC4C4FF", "#EEC6C6FF", "#EEC8C8FF",  "#EEC9C9FF", "#EECBCBFF", "#EECDCDFF", "#EECFCFFF", "#EED0D0FF", "#EED2D2FF", "#EED4D4FF", "#EED5D5FF", "#EED7D7FF", "#EED9D9FF", "#EEDBDBFF", "#EEDCDCFF", "#EEDEDEFF", "#EEE0E0FF", "#EEE1E1FF", "#EEE3E3FF", "#EEE5E5FF", "#EEE7E7FF", "#EEE8E8FF", "#EEEAEAFF", "#EEECECFF", "#EEEEEEFF")
edgeCol	 =  c("#474747FF", "#494949FF", "#4B4B4BFF", "#4D4D4DFF", "#4F4F4FFF", "#515151FF", "#535353FF", "#555555FF", "#575757FF", "#595959FF", "#5B5B5BFF", "#5E5E5EFF", "#606060FF", "#626262FF", "#646464FF", "#666666FF", "#686868FF", "#6A6A6AFF", "#6C6C6CFF", "#6E6E6EFF", "#707070FF", "#727272FF", "#747474FF", "#767676FF", "#787878FF", "#7A7A7AFF", "#7C7C7CFF", "#7E7E7EFF", "#808080FF", "#828282FF", "#848484FF", "#868686FF", "#888888FF", "#8A8A8AFF", "#8C8C8CFF", "#8D8D8DFF", "#8F8F8FFF", "#919191FF", "#939393FF",  "#959595FF", "#979797FF", "#999999FF", "#9A9A9AFF", "#9C9C9CFF", "#9E9E9EFF", "#A0A0A0FF", "#A2A2A2FF", "#A3A3A3FF", "#A5A5A5FF", "#A7A7A7FF", "#A9A9A9FF", "#AAAAAAFF", "#ACACACFF", "#AEAEAEFF", "#AFAFAFFF", "#B1B1B1FF", "#B3B3B3FF", "#B4B4B4FF", "#B6B6B6FF", "#B7B7B7FF", "#B9B9B9FF", "#BBBBBBFF", "#BCBCBCFF", "#BEBEBEFF", "#BFBFBFFF", "#C1C1C1FF", "#C2C2C2FF", "#C3C3C4FF", "#C5C5C5FF", "#C6C6C6FF", "#C8C8C8FF", "#C9C9C9FF", "#CACACAFF", "#CCCCCCFF", "#CDCDCDFF", "#CECECEFF", "#CFCFCFFF", "#D1D1D1FF",  "#D2D2D2FF", "#D3D3D3FF", "#D4D4D4FF", "#D5D5D5FF", "#D6D6D6FF", "#D7D7D7FF", "#D8D8D8FF", "#D9D9D9FF", "#DADADAFF", "#DBDBDBFF", "#DCDCDCFF", "#DDDDDDFF", "#DEDEDEFF", "#DEDEDEFF", "#DFDFDFFF", "#E0E0E0FF", "#E0E0E0FF", "#E1E1E1FF", "#E1E1E1FF", "#E2E2E2FF", "#E2E2E2FF", "#E2E2E2FF")
alpha	 =  0.5
cex	 =  1
itemLabels	 =  TRUE
labelCol	 =  #000000B3
measureLabels	 =  FALSE
precision	 =  3
layout	 =  NULL
layoutParams	 =  list()
arrowSize	 =  0.5
engine	 =  igraph
plot	 =  TRUE
plot_options	 =  list()
max	 =  100
verbose	 =  FALSE

```

![1569292045665](assets/1569292045665.png)





```R
> #신뢰도 기준 내림차순 정렬 상위 6개
> inspect(head(sort(ar4, descreasing=T, by="confidence")))
    lhs                                    rhs                                   support confidence     lift count
[1] {relationship=Husband}              => {sex=Male}                          0.4036485  0.9999493 1.495851 19715
[2] {marital-status=Married-civ-spouse,                                                                           
     relationship=Husband}              => {sex=Male}                          0.4034028  0.9999492 1.495851 19703
[3] {relationship=Husband}              => {marital-status=Married-civ-spouse} 0.4034233  0.9993914 2.181164 19704
[4] {relationship=Husband,                                                                                        
     sex=Male}                          => {marital-status=Married-civ-spouse} 0.4034028  0.9993913 2.181164 19703
[5] {marital-status=Married-civ-spouse,                                                                           
     sex=Male}                          => {relationship=Husband}              0.4034028  0.9901503 2.452877 19703
[6] {income=small}                      => {capital-loss=None}                 0.4908480  0.9698220 1.017355 23974
> 
> 
> #향상도 기준 내림차순 정렬 상위 6개
> inspect(head(sort(ar4, descreasing=T, by="lift")))
    lhs                                    rhs                                   support confidence     lift count
[1] {marital-status=Married-civ-spouse,                                                                           
     sex=Male}                          => {relationship=Husband}              0.4034028  0.9901503 2.452877 19703
[2] {relationship=Husband}              => {marital-status=Married-civ-spouse} 0.4034233  0.9993914 2.181164 19704
[3] {relationship=Husband,                                                                                        
     sex=Male}                          => {marital-status=Married-civ-spouse} 0.4034028  0.9993913 2.181164 19703
[4] {relationship=Husband}              => {sex=Male}                          0.4036485  0.9999493 1.495851 19715
[5] {marital-status=Married-civ-spouse,                                                                           
     relationship=Husband}              => {sex=Male}                          0.4034028  0.9999492 1.495851 19703
[6] {income=small}                      => {capital-gain=None}                 0.4849310  0.9581311 1.044414 23685

```





#### Groceries 데이터 셋 연관분석

```R
> data("Groceries")
> str(Groceries)
Formal class 'transactions' [package "arules"] with 3 slots
  ..@ data       :Formal class 'ngCMatrix' [package "Matrix"] with 5 slots
  .. .. ..@ i       : int [1:43367] 13 60 69 78 14 29 98 24 15 29 ...
  .. .. ..@ p       : int [1:9836] 0 4 7 8 12 16 21 22 27 28 ...
  .. .. ..@ Dim     : int [1:2] 169 9835
  .. .. ..@ Dimnames:List of 2
  .. .. .. ..$ : NULL
  .. .. .. ..$ : NULL
  .. .. ..@ factors : list()
  ..@ itemInfo   :'data.frame':	169 obs. of  3 variables:
  .. ..$ labels: chr [1:169] "frankfurter" "sausage" "liver loaf" "ham" ...
  .. ..$ level2: Factor w/ 55 levels "baby food","bags",..: 44 44 44 44 44 44 44 42 42 41 ...
  .. ..$ level1: Factor w/ 10 levels "canned food",..: 6 6 6 6 6 6 6 6 6 6 ...
  ..@ itemsetInfo:'data.frame':	0 obs. of  0 variables
> Groceries
transactions in sparse format with
 9835 transactions (rows) and
 169 items (columns)
> #1개월동안 실제 로컬 식품점 매장에서 판매되는 트랜잭션 데이터
> #transaction은 9835, item은 169
> Groceries_df <- as(Groceries, "data.frame")


> rules <- apriori(Groceries, parameter= list(supp=0.1 , conf=0.8))  # rules
Apriori

Parameter specification:
 confidence minval smax arem  aval originalSupport
        0.8    0.1    1 none FALSE            TRUE
 maxtime support minlen maxlen target   ext
       5     0.1      1     10  rules FALSE

Algorithmic control:
 filter tree heap memopt load sort verbose
    0.1 TRUE TRUE  FALSE TRUE    2    TRUE

Absolute minimum support count: 983 

set item appearances ...[0 item(s)] done [0.00s].
set transactions ...[169 item(s), 9835 transaction(s)] done [0.01s].
sorting and recoding items ... [8 item(s)] done [0.00s].
creating transaction tree ... done [0.00s].
checking subsets of size 1 2 done [0.00s].
writing ... [0 rule(s)] done [0.00s].
creating S4 object  ... done [0.00s].


> rules <- apriori(Groceries, parameter= list(supp=0.001 , conf=0.8))  # rules
Apriori

Parameter specification:
 confidence minval smax arem  aval originalSupport
        0.8    0.1    1 none FALSE            TRUE
 maxtime support minlen maxlen target   ext
       5   0.001      1     10  rules FALSE

Algorithmic control:
 filter tree heap memopt load sort verbose
    0.1 TRUE TRUE  FALSE TRUE    2    TRUE

Absolute minimum support count: 9 

set item appearances ...[0 item(s)] done [0.00s].
set transactions ...[169 item(s), 9835 transaction(s)] done [0.00s].
sorting and recoding items ... [157 item(s)] done [0.00s].
creating transaction tree ... done [0.00s].
checking subsets of size 1 2 3 4 5 6 done [0.01s].
writing ... [410 rule(s)] done [0.00s].
creating S4 object  ... done [0.00s].


> inspect(rules)

#빈도수가 가장 높은 상품 순서대로 2개

rules2 <- apriori(Groceries, parameter= list(supp=0.002 , conf=0.8))  # rules 11
inspect(rules2)
plot(rules2, method="grouped")

#빈도수가 가장 높은 상품

#규칙이 A상품 ->B상품 형태로 표현 : 왼쪽에 있는 LHS표현, 오른쪽 RHS



```



![1569293158696](assets/1569293158696.png)

```R
#최대 길이(LHS와 RHS길이의 합) 3 이하 규칙 생성
rules <- apriori(Groceries, parameter= list(supp=0.001 , conf=0.8 , maxlen=3))  # rules  29inspect(rules)

rules <- sort(rules, descreasing=T, by="confidence")
inspect(rules)
plot(rules, method="graph", control=list(type="items"))

```



![1569293546089](assets/1569293546089.png)





#### 특정 상품 서브셋 생성하여 시각화하기

```R
######특정 상품 서브셋 생성하여 시각화하기######
wmilk <- subset(rules, rhs %in% 'whole milk')
wmilk 
inspect(wmilk)
plot(wmilk, method="graph")
```

![1569298121631](assets/1569298121631.png)





```R
aveg <- subset(rules, rhs %in% 'other vegetables')
aveg
inspect(aveg)
plot(aveg, method="graph")
```



![1569298164422](assets/1569298164422.png)

#### 장바구니 연관분석 연습문제 1 

```R
################장바구니 연관분석 연습문제 1 ################
연관성 규칙은 상품 호은 서비스 간의 관계를 살펴보고 이로부터 유용한 규칙을 찾아내고자 할 때 이용될 수 있는 기법이다.
데이터들의 빈도수와 동시발생 확률을 이용하여 한 항목들의 그룹과 다른 항목들의 그룹 사이에 강한 연관성이 있음을 밝혀주는 기법이다.

예제 데이터 : B 마트에서 판매된 트랜잭션 데이터 파일
mybasket.csv

변수 : 의류, 냉동식품, 주류, 야채, 제과, 육류, 과자, 생활장식, 우유

분석문제 :
1. 전체 트랜잭션 개수와 상품아이템 유형은 몇개인가?
2. 가장  발생빈도가 높은 상품아이템은 무엇인가?
3. 지지도를 10%로 설정했을 때의 생성되는 규칙의 가짓수는?
4. 상품 아이템 중에서 가장 발생확률이 높은 아이템과 낮은 아이템은 무엇인가?
5. 가장 발생가능성이 높은 <2개 상품간>의 연관규칙은 무엇인가?
6. 가장 발생가능성이 높은 <2개 상품이상에서> <제 3의 상품으로>의 연관규칙은 무엇인가?



> result
transactions in sparse format with
 786 transactions (rows) and
 10 items (columns)
> summary(result)
transactions as itemMatrix in sparse format with
 786 rows (elements/itemsets/transactions) and
 10 columns (items) and a density of 0.3049618 

most frequent items:
clothes   snack    deco  bakery  frozen (Other) 
    386     373     358     337     318     625 

element (itemset/transaction) length distribution:
sizes
  1   2   3   4   5   6   7   8   9 
209 166 147 101  57  48  33  18   7 

   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   1.00    1.00    3.00    3.05    4.00    9.00 

includes extended item information - examples:
   labels
1 alcohol
2  bakery
3 clothes
> image(result)

as(result, "data.frame")
rules <- apriori(result, parameter=list(supp=0.1, conf=0.1))
inspect(rules)


```

![1569299809620](assets/1569299809620.png)





```R
plot(rules)
```

![1569300469632](assets/1569300469632.png)





```R
plot(rules, method="grouped")  #lhs가로축 조건과 rhs세로축-결과로 구성한 메트릭스 그래프
```

![1569300509144](assets/1569300509144.png)



```R
> plot(rules, method="graph", control=list(type="items"))
Warning: Unknown control parameters: type
Available control parameters (with default values):
main	 =  Graph for 100 rules
nodeColors	 =  c("#66CC6680", "#9999CC80")
nodeCol	 =  c("#EE0000FF", "#EE0303FF", "#EE0606FF", "#EE0909FF", "#EE0C0CFF", "#EE0F0FFF", "#EE1212FF", "#EE1515FF", "#EE1818FF", "#EE1B1BFF", "#EE1E1EFF", "#EE2222FF", "#EE2525FF", "#EE2828FF", "#EE2B2BFF", "#EE2E2EFF", "#EE3131FF", "#EE3434FF", "#EE3737FF", "#EE3A3AFF", "#EE3D3DFF", "#EE4040FF", "#EE4444FF", "#EE4747FF", "#EE4A4AFF", "#EE4D4DFF", "#EE5050FF", "#EE5353FF", "#EE5656FF", "#EE5959FF", "#EE5C5CFF", "#EE5F5FFF", "#EE6262FF", "#EE6666FF", "#EE6969FF", "#EE6C6CFF", "#EE6F6FFF", "#EE7272FF", "#EE7575FF",  "#EE7878FF", "#EE7B7BFF", "#EE7E7EFF", "#EE8181FF", "#EE8484FF", "#EE8888FF", "#EE8B8BFF", "#EE8E8EFF", "#EE9191FF", "#EE9494FF", "#EE9797FF", "#EE9999FF", "#EE9B9BFF", "#EE9D9DFF", "#EE9F9FFF", "#EEA0A0FF", "#EEA2A2FF", "#EEA4A4FF", "#EEA5A5FF", "#EEA7A7FF", "#EEA9A9FF", "#EEABABFF", "#EEACACFF", "#EEAEAEFF", "#EEB0B0FF", "#EEB1B1FF", "#EEB3B3FF", "#EEB5B5FF", "#EEB7B7FF", "#EEB8B8FF", "#EEBABAFF", "#EEBCBCFF", "#EEBDBDFF", "#EEBFBFFF", "#EEC1C1FF", "#EEC3C3FF", "#EEC4C4FF", "#EEC6C6FF", "#EEC8C8FF",  "#EEC9C9FF", "#EECBCBFF", "#EECDCDFF", "#EECFCFFF", "#EED0D0FF", "#EED2D2FF", "#EED4D4FF", "#EED5D5FF", "#EED7D7FF", "#EED9D9FF", "#EEDBDBFF", "#EEDCDCFF", "#EEDEDEFF", "#EEE0E0FF", "#EEE1E1FF", "#EEE3E3FF", "#EEE5E5FF", "#EEE7E7FF", "#EEE8E8FF", "#EEEAEAFF", "#EEECECFF", "#EEEEEEFF")
edgeCol	 =  c("#474747FF", "#494949FF", "#4B4B4BFF", "#4D4D4DFF", "#4F4F4FFF", "#515151FF", "#535353FF", "#555555FF", "#575757FF", "#595959FF", "#5B5B5BFF", "#5E5E5EFF", "#606060FF", "#626262FF", "#646464FF", "#666666FF", "#686868FF", "#6A6A6AFF", "#6C6C6CFF", "#6E6E6EFF", "#707070FF", "#727272FF", "#747474FF", "#767676FF", "#787878FF", "#7A7A7AFF", "#7C7C7CFF", "#7E7E7EFF", "#808080FF", "#828282FF", "#848484FF", "#868686FF", "#888888FF", "#8A8A8AFF", "#8C8C8CFF", "#8D8D8DFF", "#8F8F8FFF", "#919191FF", "#939393FF",  "#959595FF", "#979797FF", "#999999FF", "#9A9A9AFF", "#9C9C9CFF", "#9E9E9EFF", "#A0A0A0FF", "#A2A2A2FF", "#A3A3A3FF", "#A5A5A5FF", "#A7A7A7FF", "#A9A9A9FF", "#AAAAAAFF", "#ACACACFF", "#AEAEAEFF", "#AFAFAFFF", "#B1B1B1FF", "#B3B3B3FF", "#B4B4B4FF", "#B6B6B6FF", "#B7B7B7FF", "#B9B9B9FF", "#BBBBBBFF", "#BCBCBCFF", "#BEBEBEFF", "#BFBFBFFF", "#C1C1C1FF", "#C2C2C2FF", "#C3C3C4FF", "#C5C5C5FF", "#C6C6C6FF", "#C8C8C8FF", "#C9C9C9FF", "#CACACAFF", "#CCCCCCFF", "#CDCDCDFF", "#CECECEFF", "#CFCFCFFF", "#D1D1D1FF",  "#D2D2D2FF", "#D3D3D3FF", "#D4D4D4FF", "#D5D5D5FF", "#D6D6D6FF", "#D7D7D7FF", "#D8D8D8FF", "#D9D9D9FF", "#DADADAFF", "#DBDBDBFF", "#DCDCDCFF", "#DDDDDDFF", "#DEDEDEFF", "#DEDEDEFF", "#DFDFDFFF", "#E0E0E0FF", "#E0E0E0FF", "#E1E1E1FF", "#E1E1E1FF", "#E2E2E2FF", "#E2E2E2FF", "#E2E2E2FF")
alpha	 =  0.5
cex	 =  1
itemLabels	 =  TRUE
labelCol	 =  #000000B3
measureLabels	 =  FALSE
precision	 =  3
layout	 =  NULL
layoutParams	 =  list()
arrowSize	 =  0.5
engine	 =  igraph
plot	 =  TRUE
plot_options	 =  list()
max	 =  100
verbose	 =  FALSE
Warning message:
plot: Too many rules supplied. Only plotting the best 100 rules using ‘support’ (change control parameter max if needed) 

```

![1569300556549](assets/1569300556549.png)





```R
> plot(rules, method="graph", interactive=TRUE , control=list(type="items"))
Warning: Unknown control parameters: type
Available control parameters (with default values):
main	 =  Graph for 100 rules
nodeColors	 =  c("#66CC6680", "#9999CC80")
nodeCol	 =  c("#EE0000FF", "#EE0303FF", "#EE0606FF", "#EE0909FF", "#EE0C0CFF", "#EE0F0FFF", "#EE1212FF", "#EE1515FF", "#EE1818FF", "#EE1B1BFF", "#EE1E1EFF", "#EE2222FF", "#EE2525FF", "#EE2828FF", "#EE2B2BFF", "#EE2E2EFF", "#EE3131FF", "#EE3434FF", "#EE3737FF", "#EE3A3AFF", "#EE3D3DFF", "#EE4040FF", "#EE4444FF", "#EE4747FF", "#EE4A4AFF", "#EE4D4DFF", "#EE5050FF", "#EE5353FF", "#EE5656FF", "#EE5959FF", "#EE5C5CFF", "#EE5F5FFF", "#EE6262FF", "#EE6666FF", "#EE6969FF", "#EE6C6CFF", "#EE6F6FFF", "#EE7272FF", "#EE7575FF",  "#EE7878FF", "#EE7B7BFF", "#EE7E7EFF", "#EE8181FF", "#EE8484FF", "#EE8888FF", "#EE8B8BFF", "#EE8E8EFF", "#EE9191FF", "#EE9494FF", "#EE9797FF", "#EE9999FF", "#EE9B9BFF", "#EE9D9DFF", "#EE9F9FFF", "#EEA0A0FF", "#EEA2A2FF", "#EEA4A4FF", "#EEA5A5FF", "#EEA7A7FF", "#EEA9A9FF", "#EEABABFF", "#EEACACFF", "#EEAEAEFF", "#EEB0B0FF", "#EEB1B1FF", "#EEB3B3FF", "#EEB5B5FF", "#EEB7B7FF", "#EEB8B8FF", "#EEBABAFF", "#EEBCBCFF", "#EEBDBDFF", "#EEBFBFFF", "#EEC1C1FF", "#EEC3C3FF", "#EEC4C4FF", "#EEC6C6FF", "#EEC8C8FF",  "#EEC9C9FF", "#EECBCBFF", "#EECDCDFF", "#EECFCFFF", "#EED0D0FF", "#EED2D2FF", "#EED4D4FF", "#EED5D5FF", "#EED7D7FF", "#EED9D9FF", "#EEDBDBFF", "#EEDCDCFF", "#EEDEDEFF", "#EEE0E0FF", "#EEE1E1FF", "#EEE3E3FF", "#EEE5E5FF", "#EEE7E7FF", "#EEE8E8FF", "#EEEAEAFF", "#EEECECFF", "#EEEEEEFF")
edgeCol	 =  c("#474747FF", "#494949FF", "#4B4B4BFF", "#4D4D4DFF", "#4F4F4FFF", "#515151FF", "#535353FF", "#555555FF", "#575757FF", "#595959FF", "#5B5B5BFF", "#5E5E5EFF", "#606060FF", "#626262FF", "#646464FF", "#666666FF", "#686868FF", "#6A6A6AFF", "#6C6C6CFF", "#6E6E6EFF", "#707070FF", "#727272FF", "#747474FF", "#767676FF", "#787878FF", "#7A7A7AFF", "#7C7C7CFF", "#7E7E7EFF", "#808080FF", "#828282FF", "#848484FF", "#868686FF", "#888888FF", "#8A8A8AFF", "#8C8C8CFF", "#8D8D8DFF", "#8F8F8FFF", "#919191FF", "#939393FF",  "#959595FF", "#979797FF", "#999999FF", "#9A9A9AFF", "#9C9C9CFF", "#9E9E9EFF", "#A0A0A0FF", "#A2A2A2FF", "#A3A3A3FF", "#A5A5A5FF", "#A7A7A7FF", "#A9A9A9FF", "#AAAAAAFF", "#ACACACFF", "#AEAEAEFF", "#AFAFAFFF", "#B1B1B1FF", "#B3B3B3FF", "#B4B4B4FF", "#B6B6B6FF", "#B7B7B7FF", "#B9B9B9FF", "#BBBBBBFF", "#BCBCBCFF", "#BEBEBEFF", "#BFBFBFFF", "#C1C1C1FF", "#C2C2C2FF", "#C3C3C4FF", "#C5C5C5FF", "#C6C6C6FF", "#C8C8C8FF", "#C9C9C9FF", "#CACACAFF", "#CCCCCCFF", "#CDCDCDFF", "#CECECEFF", "#CFCFCFFF", "#D1D1D1FF",  "#D2D2D2FF", "#D3D3D3FF", "#D4D4D4FF", "#D5D5D5FF", "#D6D6D6FF", "#D7D7D7FF", "#D8D8D8FF", "#D9D9D9FF", "#DADADAFF", "#DBDBDBFF", "#DCDCDCFF", "#DDDDDDFF", "#DEDEDEFF", "#DEDEDEFF", "#DFDFDFFF", "#E0E0E0FF", "#E0E0E0FF", "#E1E1E1FF", "#E1E1E1FF", "#E2E2E2FF", "#E2E2E2FF", "#E2E2E2FF")
alpha	 =  0.5
cex	 =  1
itemLabels	 =  TRUE
labelCol	 =  #000000B3
measureLabels	 =  FALSE
precision	 =  3
layout	 =  NULL
layoutParams	 =  list()
arrowSize	 =  0.5
engine	 =  igraph
plot	 =  TRUE
plot_options	 =  list()
max	 =  100
verbose	 =  FALSE
Warning messages:
1: In plot.rules(rules, method = "graph", interactive = TRUE, control = list(type = "items")) :
  The parameter interactive is deprecated. Use engine='interactive' instead.
2: plot: Too many rules supplied. Only plotting the best 100 rules using ‘support’ (change control parameter max if needed) 

```



![1569300639625](assets/1569300639625.png)







```R
#######Twitter 앱 인증 
#twitteR 패키지 로딩 ? twitter 인증 관련 함수 제공
#ROAuth  패키지 로딩 ? OAuthFactory 객체 제공
#Base64enc 패키지 로딩 ? enc2utf8()  함수 제공
install.packages("twitteR")
install.packages("ROAuth")
install.packages("Base64enc")
library(twitteR)
library(ROAuth)
library(base64enc)

> #  Twitter 앱 요청 URL과 API 설정
> # [Details] - 3개 url 변수 생성
> reqURL <- "https://api.twitter.com/oauth/request_token"
> authURL <- "https://api.twitter.com/oauth/authorize"
> accessURL <- "https://api.twitter.com/oauth/access_token"
> # [Keys and Access Tokens] - 4개 변수 : ##Site에서 받아온다.
> apiKey <-  "" 
> apiSecret <- "" 
> accessToken="-"
> accessTokenSecret=""
> # Twitter 앱 인증 요청
> twitCred <- OAuthFactory$new(
+   consumerKey = apiKey, 
+   consumerSecret = apiSecret,
+   requestURL = reqURL,
+   accessURL = accessURL, 
+   authURL = authURL
+ )

```





## 시계열분석

- 시계열 자료 – 시간의 변화에 따라 관측치 또는 통계량의 변화를 기록해 놓은 자료
- 시계열 자료는 이전에 기록된 자료에 의존적이다.
- 시계열 자료를 대상으로 분석을 수행하기 위해서는 기존에 관측된 자료들을 분석하여 시계열 모형을 추정하고, 추정된 모델을 통해서 미래의 관측치 또는 통계량을 예측하게 된다.
- 시계열 분석은 어떤 현상에 대해서 시간의 변화량을 기록한 시계열 자료를 대상으로 미래의 변화에 대한 추세를 분석하는 방법
- ‘시간의 경과에 따른 관측값의 변화’를 패턴으로 인식하여 시계열 모형을 추정, 이 모형을 통해서 미래의 변화를 추정하는 분석 방법













## 복습

```R
> rect.hclust(hc, k=4, border = "red")
> #############분석자가 군집수를 설정(자르기)##################
> #stats::cutree()
> idist<-dist(iris[1:4])
> hc<-hclust(idist)  # 계층형 군집분석
> plot(hc, hang=-1)
> rect.hclust(hc, k=4, border = "red")
> #군집분석 결과를 대상으로 3개의 군집수를 지정
> ghc <- cutree(hc, k=3)
> ghc #군집을 의미하는 1~3의 숫자로 출력
  [1] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
 [24] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
 [47] 1 1 1 1 2 2 2 3 2 3 2 3 2 3 3 3 3 2 3 2 3 3 2
 [70] 3 2 3 2 2 2 2 2 2 2 3 3 3 3 2 3 2 2 2 3 3 3 2
 [93] 3 3 3 3 3 2 3 3 2 2 2 2 2 2 3 2 2 2 2 2 2 2 2
[116] 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2
[139] 2 2 2 2 2 2 2 2 2 2 2 2

> iris$ghc <- ghc
> table(iris$ghc) #군집수의 빈도수수

 1  2  3 
50 72 28 


> #각 군집별로 내적 특성, 다른 군집과의 차이에 해당하는 외적 특성 확인
> g1<-subset(iris, ghc==1)
> summary(g1[1:4])
  Sepal.Length    Sepal.Width     Petal.Length  
 Min.   :4.300   Min.   :2.300   Min.   :1.000  
 1st Qu.:4.800   1st Qu.:3.200   1st Qu.:1.400  
 Median :5.000   Median :3.400   Median :1.500  
 Mean   :5.006   Mean   :3.428   Mean   :1.462  
 3rd Qu.:5.200   3rd Qu.:3.675   3rd Qu.:1.575  
 Max.   :5.800   Max.   :4.400   Max.   :1.900  
  Petal.Width   
 Min.   :0.100  
 1st Qu.:0.200  
 Median :0.200  
 Mean   :0.246  
 3rd Qu.:0.300  
 Max.   :0.600  
> 
> g2<-subset(iris, ghc==2)
> summary(g2[1:4])
  Sepal.Length    Sepal.Width     Petal.Length  
 Min.   :5.600   Min.   :2.200   Min.   :4.300  
 1st Qu.:6.200   1st Qu.:2.800   1st Qu.:4.800  
 Median :6.400   Median :3.000   Median :5.100  
 Mean   :6.546   Mean   :2.964   Mean   :5.274  
 3rd Qu.:6.800   3rd Qu.:3.125   3rd Qu.:5.700  
 Max.   :7.900   Max.   :3.800   Max.   :6.900  
  Petal.Width  
 Min.   :1.20  
 1st Qu.:1.50  
 Median :1.80  
 Mean   :1.85  
 3rd Qu.:2.10  
 Max.   :2.50  
> 
> g3<-subset(iris, ghc==3)
> summary(g3[1:4])
  Sepal.Length    Sepal.Width     Petal.Length  
 Min.   :4.900   Min.   :2.000   Min.   :3.000  
 1st Qu.:5.475   1st Qu.:2.475   1st Qu.:3.775  
 Median :5.600   Median :2.650   Median :4.000  
 Mean   :5.532   Mean   :2.636   Mean   :3.961  
 3rd Qu.:5.700   3rd Qu.:2.825   3rd Qu.:4.200  
 Max.   :6.100   Max.   :3.000   Max.   :4.500  
  Petal.Width   
 Min.   :1.000  
 1st Qu.:1.075  
 Median :1.250  
 Mean   :1.229  
 3rd Qu.:1.300  
 Max.   :1.700  

```

![1569284219614](assets/1569284219614.png)





### 최단연결법

```R
#############군집분석 : 최단연결법(Single Linkage Method)##########
#군집에 속하는 두 개체(데이터) 사이의 최단 거리를 이용
#가장 유사성이 큰 개체들을 군집으로 묶어 나가는 방법
#빠르고, 자료에 대한 단조변환에 대하여 Tree구조가 불변하기 때문에 
#순서적 의미를 갖는 자료에 대해서 좋은 결과를 제공함
#최단연결법(Single Linkage Method)은 고립된 군집을 찾는데 유용


> a <- c(1, 5)
> b <- c(2, 3)
> c <- c(5, 7)
> d <- c(3, 5)
> e <- c(5, 2)
> data <- data.frame(a, b, c, d, e)
> data <- t(data)
> data
  [,1] [,2]
a    1    5
b    2    3
c    5    7
d    3    5
e    5    2



> m1 <- hclust(dist(data)^2, method = "single")
> plot(m1)
```

![1569284956981](assets/1569284956981.png)







### 최장연결법

```R
# 최장연결법(Complete Linkage Method)
#군집들의 응집성을 찾는데 유용

> m2 <- hclust(dist(data)^2, method="complete")
> plot(m2)
```



![1569285243798](assets/1569285243798.png)



### 와드연결법

```R
#새로운 군집으로 인하여 파생되는 ESS(오차 제곱의 합)의 증가량을
#두 군집 사이의 거리로 정의하여 가장 유사성이 큰 개체들을 군집으로 묶어 가는 방법

> m3<-hclust(dist(data)^2, method="ward.D2")
> plot(m3)
```

![1569285436493](assets/1569285436493.png)







### 평균 연결법

```R
#########평균 연결법(Average Linkage Method) #########
#두 군집 사이의 거리를 각 군집에 속하는 모든 개체들의 평균거리로 정의하여
#가장 유사성이 큰 개체들을 군집으로 묶어 가는 방법

> m4<-hclust(dist(data)^2, method="average")
> plot(m4)

```

![1569285482087](assets/1569285482087.png)







### 비계층적 군집 분석

```R
##############비계층적 군집 분석 #######################
> library(ggplot2)
> data(diamonds)
> t <- sample(1:nrow(diamonds), 1000)
> test <- diamonds[t, ]   #표본으로 검정 데이터 생성
> names(test)
 [1] "carat"   "cut"     "color"   "clarity"
 [5] "depth"   "table"   "price"   "x"      
 [9] "y"       "z"      

> data<- test[c("price", "carat", "depth", "table")]
> head(data)
# A tibble: 6 x 4
  price carat depth table
  <int> <dbl> <dbl> <dbl>
1  1740  0.53  61.6    55
2  4253  0.91  59.3    58
3  4656  1.06  62      59
4   524  0.32  61.2    58
5  4586  1.05  61.9    56
6   689  0.34  63.7    57
> #계층적 군집분석
> result <- hclust(dist(data), method="ave")
> result

Call:
hclust(d = dist(data), method = "ave")

Cluster method   : average 
Distance         : euclidean 
Number of objects: 1000 

> plot(result, hang=-1)

```

![1569285889916](assets/1569285889916.png)





```R
> #3개의 군집수를 적용하여 비계층적 군집분석 수행
> result2 <- kmeans(data, 3)  
> names(result2)
[1] "cluster"      "centers"      "totss"       
[4] "withinss"     "tot.withinss" "betweenss"   
[7] "size"         "iter"         "ifault"      
> result2$cluster #각 개체가 속하는 군집수 확인
   [1] 3 2 2 3 2 3 3 2 3 3 2 3 3 3 2 3 3 3 2 3 1 3 3
  [24] 2 3 3 3 2 1 2 3 2 2 1 3 3 2 3 3 2 3 3 1 3 3 2
  [47] 1 3 1 3 3 3 3 1 2 2 2 1 3 3 3 2 2 3 3 2 2 1 1
  [70] 2 1 3 3 1 3 2 1 3 1 3 2 3 3 3 3 2 2 3 2 1 3 3
  [93] 3 2 3 3 3 2 3 2 2 3 3 1 3 2 2 3 3 2 3 3 3 3 3
 [116] 2 2 3 3 3 3 3 3 3 2 3 3 1 3 3 3 3 1 3 3 1 3 2
 [139] 3 2 3 3 3 2 3 1 3 2 1 3 1 3 1 3 3 2 1 3 1 3 1
 [162] 2 2 3 3 2 3 3 2 2 3 2 3 3 3 2 3 3 3 3 1 1 3 3
 [185] 3 3 3 3 3 3 3 3 3 3 2 3 3 2 2 1 2 2 2 1 2 3 3
 [208] 3 3 2 3 3 3 3 3 1 3 3 2 3 3 2 3 3 1 3 3 3 2 3
 [231] 1 2 3 1 3 3 2 2 1 3 2 3 2 2 2 3 3 3 2 3 2 1 3
 [254] 3 3 2 2 2 3 3 3 3 1 2 3 2 2 3 3 2 3 3 1 3 3 2
 [277] 2 3 3 1 3 3 3 2 1 2 1 2 2 1 1 2 1 3 3 3 2 1 3
 [300] 3 1 3 3 2 2 2 3 2 3 3 2 3 3 2 3 2 3 3 3 3 2 3
 [323] 3 2 3 2 2 3 3 3 3 2 3 3 3 2 2 2 1 2 2 3 3 2 3
 [346] 2 3 3 2 3 1 3 2 2 3 3 3 3 2 1 2 3 3 3 3 1 2 1
 [369] 3 2 3 3 3 2 3 3 3 1 3 3 2 3 2 3 3 3 3 3 3 3 3
 [392] 3 3 3 3 3 3 3 1 3 3 3 2 2 3 2 3 1 3 1 2 2 3 3
 [415] 2 3 3 2 2 3 2 3 3 3 2 3 3 3 3 3 3 3 3 3 3 3 3
 [438] 3 3 3 3 3 1 1 3 1 2 2 2 3 3 3 3 1 2 3 3 3 2 3
 [461] 2 2 1 3 3 3 2 3 3 3 3 1 2 3 3 3 2 2 2 2 3 3 3
 [484] 3 3 3 3 2 3 2 3 2 3 3 2 3 3 1 2 3 3 2 2 2 1 3
 [507] 2 2 3 3 3 3 2 3 2 3 3 3 1 2 2 1 2 2 2 3 3 2 3
 [530] 3 3 1 2 3 3 3 3 2 2 3 3 2 3 3 3 3 1 1 3 3 3 3
 [553] 3 2 3 3 3 2 1 3 2 1 3 3 2 2 1 2 2 1 3 3 2 3 2
 [576] 2 3 3 2 3 1 3 2 3 2 3 2 2 3 1 3 3 3 2 1 2 3 3
 [599] 3 2 3 2 3 3 2 1 3 3 2 3 3 2 3 3 3 3 2 2 2 3 3
 [622] 3 3 3 3 3 3 3 3 1 3 3 3 3 1 2 1 3 3 3 2 2 2 2
 [645] 3 2 2 3 1 3 3 1 3 3 2 3 2 2 3 1 3 3 3 3 3 3 1
 [668] 1 3 3 1 2 3 3 3 3 2 3 2 3 2 3 3 2 3 3 3 2 3 3
 [691] 3 3 2 3 3 1 3 3 3 3 3 2 1 3 3 1 2 3 3 2 1 3 3
 [714] 2 2 2 3 3 2 3 1 2 2 2 2 1 3 2 2 3 3 3 2 3 3 3
 [737] 3 3 2 3 3 3 3 3 1 2 2 2 3 3 2 2 1 3 3 3 3 2 3
 [760] 3 3 3 3 1 3 1 3 3 3 3 3 2 3 3 3 3 3 3 3 3 3 2
 [783] 2 3 1 3 3 2 3 3 3 3 3 3 2 2 3 2 3 3 3 3 1 1 3
 [806] 2 3 2 3 3 3 1 3 2 2 3 3 3 2 2 2 3 2 3 3 1 3 2
 [829] 2 3 3 2 3 3 3 3 1 2 3 3 1 2 3 2 3 2 3 3 2 3 3
 [852] 3 1 3 3 2 3 2 2 3 3 3 3 3 3 3 3 3 3 2 3 1 2 3
 [875] 3 1 2 3 3 2 3 3 2 2 2 2 2 1 3 3 3 3 2 3 3 2 3
 [898] 2 3 3 3 2 3 3 3 3 3 2 3 2 2 3 3 3 3 2 3 3 3 2
 [921] 2 3 2 3 3 3 1 2 1 3 3 3 1 3 2 2 2 3 3 1 3 3 2
 [944] 3 1 3 2 3 1 3 3 3 3 3 3 3 3 3 3 1 2 2 3 3 2 2
 [967] 3 3 2 3 3 1 3 3 3 3 3 3 3 3 2 3 3 3 2 2 3 3 3
 [990] 3 3 3 3 2 3 3 3 3 3 1


```



### iris 데이터셋 비계층적 군집 분석

```R
> ########iris 데이터셋 비계층적 군집 분석 ##########
>      data<-iris
>      data$Species <- NULL
>      head(data)
  Sepal.Length Sepal.Width Petal.Length Petal.Width
1          5.1         3.5          1.4         0.2
2          4.9         3.0          1.4         0.2
3          4.7         3.2          1.3         0.2
4          4.6         3.1          1.5         0.2
5          5.0         3.6          1.4         0.2
6          5.4         3.9          1.7         0.4
  ghc
1   1
2   1
3   1
4   1
5   1
6   1
>      m<-kmeans(data, 3)
>      
>      table(iris$Species, m$cluster)
            
              1  2  3
  setosa      0  0 50
  versicolor 47  3  0
  virginica  13 37  0
>      plot(data[c("Sepal.Length", "Sepal.Width")], main="kmeans", col=m$cluster)     

```

![1569287850202](assets/1569287850202.png)



```R
> m2<-kmeans(data, 4)
> m2
K-means clustering with 4 clusters of sizes 27, 45, 50, 28

Cluster means:
  Sepal.Length Sepal.Width Petal.Length Petal.Width
1     7.014815    3.096296     5.918519    2.155556
2     6.264444    2.884444     4.886667    1.666667
3     5.006000    3.428000     1.462000    0.246000
4     5.532143    2.635714     3.960714    1.228571
  ghc
1   2
2   2
3   1
4   3

Clustering vector:
  [1] 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3
 [24] 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3
 [47] 3 3 3 3 2 2 2 4 2 4 2 4 2 4 4 4 4 2 4 2 4 4 2
 [70] 4 2 4 2 2 2 2 2 2 2 4 4 4 4 2 4 2 2 2 4 4 4 2
 [93] 4 4 4 4 4 2 4 4 1 2 1 2 1 1 4 1 1 1 2 2 1 2 2
[116] 2 2 1 1 2 1 2 1 2 1 1 2 2 1 1 1 1 1 2 2 1 1 2
[139] 2 1 1 1 2 1 1 1 2 2 2 2

Within cluster sum of squares by cluster:
[1] 15.351111 17.014222 15.151000  9.749286
 (between_SS / total_SS =  92.4 %)

Available components:

[1] "cluster"      "centers"      "totss"       
[4] "withinss"     "tot.withinss" "betweenss"   
[7] "size"         "iter"         "ifault"      
> 
> table(iris$Species, m2$cluster)  
            
              1  2  3  4
  setosa      0  0 50  0
  versicolor  0 23  0 27
  virginica  27 22  0  1

```





